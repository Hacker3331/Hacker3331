-- ==========================================
-- SHIFTLOCK DENGAN CROSSHAIR SYSTEM
-- ==========================================

-- ==================== SETTINGS ====================
local CrosshairSettings = {
    -- URL gambar crosshair (ganti dengan ID asset Anda)
    CrosshairImage = "rbxasset://textures/ui/crosshair.png",
    
    -- Ukuran crosshair
    CrosshairSize = UDim2.new(0, 32, 0, 32),
    
    -- Posisi crosshair (default: tengah layar)
    CrosshairPosition = UDim2.new(0.5, 0, 0.5, 0),
    
    -- Transparansi crosshair (0 = terlihat penuh, 1 = tidak terlihat)
    CrosshairTransparency = 0,
    
    -- Tampilkan crosshair saat shiftlock aktif
    ShowOnShiftlock = true,
    
    -- Tampilkan crosshair saat first person
    ShowOnFirstPerson = false,
    
    -- Animasi saat crosshair muncul/hilang
    EnableAnimation = true,
    AnimationSpeed = 0.1
}
-- ==========================================

local ShiftlockStarterGui = Instance.new("ScreenGui")
local ImageButton = Instance.new("ImageButton")

ShiftlockStarterGui.Name = "Shiftlock (StarterGui)"
ShiftlockStarterGui.Parent = game.CoreGui
ShiftlockStarterGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ShiftlockStarterGui.ResetOnSpawn = false

ImageButton.Parent = ShiftlockStarterGui
ImageButton.Active = true
ImageButton.Draggable = true
ImageButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
ImageButton.BackgroundTransparency = 1.000
ImageButton.Position = UDim2.new(0.921914339, 0, 0.552375436, 0)
ImageButton.Size = UDim2.new(0.0636147112, 0, 0.0661305636, 0)
ImageButton.SizeConstraint = Enum.SizeConstraint.RelativeXX
ImageButton.Image = "http://www.roblox.com/asset/?id=182223762"

-- ==================== CROSSHAIR SYSTEM ====================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

local CrosshairGui = Instance.new("ScreenGui")
CrosshairGui.Name = "CustomCrosshair"
CrosshairGui.Parent = game.CoreGui
CrosshairGui.IgnoreGuiInset = true
CrosshairGui.ResetOnSpawn = false

local Crosshair = Instance.new("ImageLabel")
Crosshair.Name = "CrosshairImage"
Crosshair.Parent = CrosshairGui
Crosshair.BackgroundTransparency = 1
Crosshair.Image = CrosshairSettings.CrosshairImage
Crosshair.Size = CrosshairSettings.CrosshairSize
Crosshair.Position = CrosshairSettings.CrosshairPosition
Crosshair.AnchorPoint = Vector2.new(0.5, 0.5)
Crosshair.Visible = false
Crosshair.ZIndex = 10

local isShiftLocked = false
local isFirstPerson = false
local isCrosshairVisible = false
local currentTransparency = 1

local function UpdateCrosshairVisibility()
    local shouldShow = false
    
    if CrosshairSettings.ShowOnShiftlock and isShiftLocked then
        shouldShow = true
    end
    
    if CrosshairSettings.ShowOnFirstPerson and isFirstPerson then
        shouldShow = true
    end
    
    if shouldShow and not isCrosshairVisible then
        isCrosshairVisible = true
        if CrosshairSettings.EnableAnimation then
            for i = currentTransparency, 0, -CrosshairSettings.AnimationSpeed do
                currentTransparency = i
                Crosshair.ImageTransparency = i
                Crosshair.Visible = true
                RunService.RenderStepped:Wait()
            end
            currentTransparency = 0
            Crosshair.ImageTransparency = 0
        else
            Crosshair.Visible = true
            Crosshair.ImageTransparency = CrosshairSettings.CrosshairTransparency
        end
    elseif not shouldShow and isCrosshairVisible then
        isCrosshairVisible = false
        if CrosshairSettings.EnableAnimation then
            for i = currentTransparency, 1, CrosshairSettings.AnimationSpeed do
                currentTransparency = i
                Crosshair.ImageTransparency = i
                RunService.RenderStepped:Wait()
            end
            currentTransparency = 1
            Crosshair.ImageTransparency = 1
            Crosshair.Visible = false
        else
            Crosshair.Visible = false
            Crosshair.ImageTransparency = 1
        end
    end
end

local function CheckShiftLockState()
    local success, result = pcall(function()
        if not player.Character then return false end
        local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
        if not humanoid then return false end
        return not humanoid.AutoRotate
    end)
    
    if success then
        isShiftLocked = result
        UpdateCrosshairVisibility()
    end
end

local function CheckFirstPerson()
    local success, result = pcall(function()
        local camera = workspace.CurrentCamera
        if not camera then return false end
        return camera.FieldOfView >= 80
    end)
    
    if success then
        isFirstPerson = result
        UpdateCrosshairVisibility()
    end
end

local function OnCharacterAdded(character)
    isShiftLocked = false
    isFirstPerson = false
    isCrosshairVisible = false
    currentTransparency = 1
    Crosshair.Visible = false
    Crosshair.ImageTransparency = 1
    
    local humanoid = character:WaitForChild("Humanoid")
    humanoid:GetPropertyChangedSignal("AutoRotate"):Connect(CheckShiftLockState)
    CheckShiftLockState()
end

local function OnCameraChanged()
    CheckFirstPerson()
end

player.CharacterAdded:Connect(OnCharacterAdded)

local camera = workspace.CurrentCamera
if camera then
    camera:GetPropertyChangedSignal("FieldOfView"):Connect(OnCameraChanged)
end

workspace:GetPropertyChangedSignal("CurrentCamera"):Connect(function()
    local newCamera = workspace.CurrentCamera
    if newCamera then
        newCamera:GetPropertyChangedSignal("FieldOfView"):Connect(OnCameraChanged)
    end
end)

RunService.RenderStepped:Connect(function()
    CheckShiftLockState()
    CheckFirstPerson()
end)

if player.Character then
    OnCharacterAdded(player.Character)
end

print("Shiftlock & Crosshair system loaded successfully!")
-- ==================== END CROSSHAIR SYSTEM ====================

-- ==================== SHIFTGUI SCRIPT ====================
local function TLQOYN_fake_script()
    local script = Instance.new('LocalScript', ImageButton)

    local MobileCameraFramework = {}
    local players = game:GetService("Players")
    local runservice = game:GetService("RunService")
    local CAS = game:GetService("ContextActionService")
    local player = players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local root = character:WaitForChild("HumanoidRootPart")
    local humanoid = character.Humanoid
    local camera = workspace.CurrentCamera
    local button = script.Parent
    
    local uis = game:GetService("UserInputService")
    local ismobile = uis.TouchEnabled
    button.Visible = ismobile
    
    local states = {
        OFF = "rbxasset://textures/ui/mouseLock_off@2x.png",
        ON = "rbxasset://textures/ui/mouseLock_on@2x.png"
    }
    local MAX_LENGTH = 900000
    local active = false
    local ENABLED_OFFSET = CFrame.new(1.7, 0, 0)
    local DISABLED_OFFSET = CFrame.new(-1.7, 0, 0)
    local rootPos = Vector3.new(0,0,0)
    
    local function UpdatePos()
        if player.Character and player.Character:FindFirstChildOfClass"Humanoid" and player.Character:FindFirstChildOfClass"Humanoid".RootPart then
            rootPos = player.Character:FindFirstChildOfClass"Humanoid".RootPart.Position
        end
    end
    
    local function UpdateImage(STATE)
        button.Image = states[STATE]
    end
    
    local function UpdateAutoRotate(BOOL)
        if player.Character and player.Character:FindFirstChildOfClass"Humanoid" then
            player.Character:FindFirstChildOfClass"Humanoid".AutoRotate = BOOL
        end
    end
    
    local function GetUpdatedCameraCFrame()
        if game:GetService"Workspace".CurrentCamera then
            return CFrame.new(rootPos, Vector3.new(game:GetService"Workspace".CurrentCamera.CFrame.LookVector.X * MAX_LENGTH, rootPos.Y, game:GetService"Workspace".CurrentCamera.CFrame.LookVector.Z * MAX_LENGTH))
        end
    end
    
    local function EnableShiftlock()
        UpdatePos()
        UpdateAutoRotate(false)
        UpdateImage("ON")
        if player.Character and player.Character:FindFirstChildOfClass"Humanoid" and player.Character:FindFirstChildOfClass"Humanoid".RootPart then
            player.Character:FindFirstChildOfClass"Humanoid".RootPart.CFrame = GetUpdatedCameraCFrame()
        end
        if game:GetService"Workspace".CurrentCamera then
            game:GetService"Workspace".CurrentCamera.CFrame = camera.CFrame * ENABLED_OFFSET
        end
    end
    
    local function DisableShiftlock()
        UpdatePos()
        UpdateAutoRotate(true)
        UpdateImage("OFF")
        if game:GetService"Workspace".CurrentCamera then
            game:GetService"Workspace".CurrentCamera.CFrame = camera.CFrame * DISABLED_OFFSET
        end
        pcall(function()
            active:Disconnect()
            active = nil
        end)
    end
    
    UpdateImage("OFF")
    active = false
    
    function ShiftLock()
        if not active then
            active = runservice.RenderStepped:Connect(function()
                EnableShiftlock()
            end)
        else
            DisableShiftlock()
        end
    end
    
    local ShiftLockButton = CAS:BindAction("ShiftLOCK", ShiftLock, false, "On")
    CAS:SetPosition("ShiftLOCK", UDim2.new(0.8, 0, 0.8, 0))
    
    button.MouseButton1Click:Connect(function()
        if not active then
            active = runservice.RenderStepped:Connect(function()
                EnableShiftlock()
            end)
        else
            DisableShiftlock()
        end
    end)
    
    return MobileCameraFramework
end
coroutine.wrap(TLQOYN_fake_script)()
-- ==================== END SHIFTGUI SCRIPT ====================

-- ==================== SHIFTLOCK CONTROLLER SCRIPT ====================
local function OMQRQRC_fake_script()
    local script = Instance.new('LocalScript', ShiftlockStarterGui)

    local Players = game:GetService("Players")
    local UserInputService = game:GetService("UserInputService")
    local Settings = UserSettings()
    local GameSettings = Settings.GameSettings
    local ShiftLockController = {}
    
    while not Players.LocalPlayer do wait() end
    
    local LocalPlayer = Players.LocalPlayer
    local Mouse = LocalPlayer:GetMouse()
    local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
    local ScreenGui, ShiftLockIcon, InputCn
    local IsShiftLockMode = true
    local IsShiftLocked = true
    local IsActionBound = false
    local IsInFirstPerson = false
    
    ShiftLockController.OnShiftLockToggled = Instance.new("BindableEvent")
    
    local function isShiftLockMode()
        return LocalPlayer.DevEnableMouseLock 
            and GameSettings.ControlMode == Enum.ControlMode.MouseLockSwitch 
            and LocalPlayer.DevComputerMovementMode ~= Enum.DevComputerMovementMode.ClickToMove 
            and GameSettings.ComputerMovementMode ~= Enum.ComputerMovementMode.ClickToMove 
            and LocalPlayer.DevComputerMovementMode ~= Enum.DevComputerMovementMode.Scriptable
    end
    
    if not UserInputService.TouchEnabled then
        IsShiftLockMode = isShiftLockMode()
    end
    
    local function onShiftLockToggled()
        IsShiftLocked = not IsShiftLocked
        ShiftLockController.OnShiftLockToggled:Fire()
    end
    
    local initialize = function()
        print("enabled")
    end
    
    function ShiftLockController:IsShiftLocked()
        return IsShiftLockMode and IsShiftLocked
    end
    
    function ShiftLockController:SetIsInFirstPerson(isInFirstPerson)
        IsInFirstPerson = isInFirstPerson
    end
    
    local function disableShiftLock()
        if ScreenGui then
            ScreenGui.Parent = nil
        end
        IsShiftLockMode = false
        Mouse.Icon = ""
        if InputCn then
            InputCn:disconnect()
            InputCn = nil
        end
        IsActionBound = false
        ShiftLockController.OnShiftLockToggled:Fire()
    end
    
    local function enableShiftLock()
        IsShiftLockMode = isShiftLockMode()
        if IsShiftLockMode then
            if ScreenGui then
                ScreenGui.Parent = PlayerGui
            end
            if IsShiftLocked then
                ShiftLockController.OnShiftLockToggled:Fire()
            end
            if not IsActionBound then
                InputCn = UserInputService.InputBegan:connect(function(inputObject, isProcessed)
                    if isProcessed then return end
                    if inputObject.UserInputType ~= Enum.UserInputType.Keyboard or inputObject.KeyCode == Enum.KeyCode.LeftShift or inputObject.KeyCode == Enum.KeyCode.RightShift then
                    end
                end)
                IsActionBound = true
            end
        end
    end
    
    GameSettings.Changed:connect(function(property)
        if property == "ControlMode" then
            if GameSettings.ControlMode == Enum.ControlMode.MouseLockSwitch then
                enableShiftLock()
            else
                disableShiftLock()
            end
        elseif property == "ComputerMovementMode" then
            if GameSettings.ComputerMovementMode == Enum.ComputerMovementMode.ClickToMove then
                disableShiftLock()
            else
                enableShiftLock()
            end
        end
    end)
    
    LocalPlayer.Changed:connect(function(property)
        if property == "DevEnableMouseLock" then
            if LocalPlayer.DevEnableMouseLock then
                enableShiftLock()
            else
                disableShiftLock()
            end
        elseif property == "DevComputerMovementMode" then
            if LocalPlayer.DevComputerMovementMode == Enum.DevComputerMovementMode.ClickToMove or LocalPlayer.DevComputerMovementMode == Enum.DevComputerMovementMode.Scriptable then
                disableShiftLock()
            else
                enableShiftLock()
            end
        end
    end)
    
    LocalPlayer.CharacterAdded:connect(function(character)
        if not UserInputService.TouchEnabled then
            initialize()
        end
    end)
    
    if not UserInputService.TouchEnabled then
        initialize()
        if isShiftLockMode() then
            InputCn = UserInputService.InputBegan:connect(function(inputObject, isProcessed)
                if isProcessed then return end
                if inputObject.UserInputType ~= Enum.UserInputType.Keyboard or inputObject.KeyCode == Enum.KeyCode.LeftShift or inputObject.KeyCode == Enum.KeyCode.RightShift then
                end
            end)
            IsActionBound = true
        end
    end
    
    enableShiftLock()
    return ShiftLockController
end
coroutine.wrap(OMQRQRC_fake_script)()
-- ==================== END SHIFTLOCK CONTROLLER SCRIPT ====================

-- ==========================================
-- AKHIR SCRIPT
-- ==========================================
